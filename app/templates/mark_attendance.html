<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mark Attendance</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2>Face Recognition Attendance</h2>
    <p>Use your webcam to capture a photo of the class. The system will recognize students and mark their attendance.</p>
    <form id="face-attendance-form" method="post" enctype="multipart/form-data" action="{{ url_for('face_recognition_attendance') }}">
        <div class="mb-3">
            <video id="video" width="480" height="360" autoplay class="border"></video>
            <canvas id="canvas" width="480" height="360" style="display:none;"></canvas>
        </div>
        <div class="mb-3">
            <label for="attendance_date" class="form-label">Select Date:</label>
            <input type="date" id="attendance_date" name="attendance_date" class="form-control w-auto d-inline-block" value="{{ (request.form.attendance_date or request.args.get('attendance_date') or '') }}">
        </div>
        <input type="hidden" name="image_data" id="image_data">
        <button type="button" class="btn btn-primary" onclick="capturePhoto()">Capture & Mark Attendance</button>
        <a href="{{ url_for('teacher_dashboard') }}" class="btn btn-secondary ms-2">Back to Dashboard</a>
    </form>
    <script>
    // Access webcam
    const video = document.getElementById('video');
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { video.srcObject = stream; })
        .catch(err => { alert('Webcam access denied: ' + err); });
    // Capture photo
    function capturePhoto() {
        const canvas = document.getElementById('canvas');
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
        const dataURL = canvas.toDataURL('image/jpeg');
        document.getElementById('image_data').value = dataURL;
        // Optionally validate date
        const dateInput = document.getElementById('attendance_date');
        if (!dateInput.value) {
            alert('Please select a date for attendance.');
            return;
        }
        document.getElementById('face-attendance-form').submit();
    }
    </script>
</div>
</body>
</html>
